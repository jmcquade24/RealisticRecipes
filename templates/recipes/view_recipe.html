<button id="like-btn" data-slug="{{ recipe.slug }}">&#128077; Like (<span id="like-count">{{ recipe.likes }}</span>)</button>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const likeButton = document.getElementById("like-btn");

    likeButton.addEventListener("click", function () {
        const recipeSlug = likeButton.getAttribute("data-slug");
        const likeCountElement = document.getElementById("like-count");

        // Disable button to prevent multiple clicks
        likeButton.disabled = true;

        fetch(`/recipe/${recipeSlug}/like/`, {
            method: "POST",
            headers: {
                "X-Requested-With": "XMLHttpRequest",  // Identifies AJAX request
                "X-CSRFToken": getCSRFToken(),          // CSRF token for security
                "Content-Type": "application/json"
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            likeCountElement.textContent = data.likes;
            likeButton.disabled = false;  // Re-enable button after response
        })
        .catch(error => {
            console.error("Error liking recipe:", error);
            likeButton.disabled = false;
        });
    });

    // Function to retrieve CSRF token from cookies (for Django)
    function getCSRFToken() {
        let cookieValue = null;
        const cookies = document.cookie.split(";");
        for (let cookie of cookies) {
            const [name, value] = cookie.trim().split("=");
            if (name === "csrftoken") {
                cookieValue = decodeURIComponent(value);
                break;
            }
        }
        return cookieValue;
    }
});
</script>
